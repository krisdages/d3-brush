// https://d3js.org/d3-brush/ v1.0.6 Copyright 2019 Mike Bostock
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-selection"),require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-dispatch","d3-drag","d3-interpolate","d3-transition"],t):t(e.d3=e.d3||{},e.d3,e.d3,e.d3,e.d3,e.d3)}(this,function(e,t,n,r,s,i){"use strict";function u(e){return function(){return e}}function a(e,t,n){this.target=e,this.type=t,this.selection=n}function o(){t.event.stopImmediatePropagation()}function l(){t.event.preventDefault(),t.event.stopImmediatePropagation()}var c={};function h(e){this._keyCode=e}c[18]="altKey",c[17]="ctrlKey",c[16]="shiftKey",c[91]="metaKey",h.prototype={keyCode:function(e){return void 0===e?this._keyCode:(this._keyCode=null===e?null:+e,this)}};var d=new h(91),f=new h(32),p=new h(18),y=new h(16),v={name:"drag"},b={name:"space"},m={name:"handle"},w={name:"center"},_={name:"x",handles:["e","w"].map(q),input:function(e,t){return e&&[[e[0],t[0][1]],[e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},k={name:"y",handles:["n","s"].map(q),input:function(e,t){return e&&[[t[0][0],e[0]],[t[1][0],e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},g={name:"xy",handles:["n","e","s","w","nw","ne","se","sw"].map(q),input:function(e){return e},output:function(e){return e}},x={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},M={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},C={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},z={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},A={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function q(e){return{type:e}}function S(){return!t.event.button}function E(){var e=this.ownerSVGElement||this;return[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function F(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function K(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function P(e){var g,P=E,T=S,V=n.dispatch(X,"start","brush","end"),j=6,D=new h(d._keyCode),I=new h(f._keyCode),N=new h(p._keyCode),G=new h(y._keyCode);function O(e,t){var n=t._keyCode;if(null===n)return!1;var r=c[n];return void 0!==r&&e[r]}function X(n){var r=n.property("__brush",L).selectAll(".overlay").data([q("overlay")]);r.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",x.overlay).merge(r).each(function(){var e=F(this).extent;t.select(this).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1])}),n.selectAll(".selection").data([q("selection")]).enter().append("rect").attr("class","selection").attr("cursor",x.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var s=n.selectAll(".handle").data(e.handles,function(e){return e.type});s.exit().remove(),s.enter().append("rect").attr("class",function(e){return"handle handle--"+e.type}).attr("cursor",function(e){return x[e.type]}),n.each(Y).attr("fill","none").attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush touchstart.brush",J)}function Y(){var e=t.select(this),n=F(this).selection;n?(e.selectAll(".selection").style("display",null).attr("x",n[0][0]).attr("y",n[0][1]).attr("width",n[1][0]-n[0][0]).attr("height",n[1][1]-n[0][1]),e.selectAll(".handle").style("display",null).attr("x",function(e){return"e"===e.type[e.type.length-1]?n[1][0]-j/2:n[0][0]-j/2}).attr("y",function(e){return"s"===e.type[0]?n[1][1]-j/2:n[0][1]-j/2}).attr("width",function(e){return"n"===e.type||"s"===e.type?n[1][0]-n[0][0]+j:j}).attr("height",function(e){return"e"===e.type||"w"===e.type?n[1][1]-n[0][1]+j:j})):e.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function B(e,t){return e.__brush.emitter||new H(e,t)}function H(e,t){this.that=e,this.args=t,this.state=e.__brush,this.active=0}function J(){if(t.event.touches){if(t.event.changedTouches.length<t.event.touches.length)return l()}else if(g)return;if(T.apply(this,arguments)){var n,s,u,a,c,h,d,f,p,y,q,S,E,P=this,V=t.event.target.__data__.type,j="selection"===(O(t.event,D)?V="overlay":V)?v:O(t.event,N)?w:m,X=e===k?null:z[V],H=e===_?null:A[V],J=F(P),L=J.extent,Q=J.selection,R=L[0][0],U=L[0][1],W=L[1][0],Z=L[1][1],$=X&&H&&O(t.event,G),ee=O(t.event,N),te=t.mouse(P),ne=te,re=B(P,arguments).beforestart();"overlay"===V?J.selection=Q=[[n=e===k?R:te[0],u=e===_?U:te[1]],[c=e===k?W:n,d=e===_?Z:u]]:(n=Q[0][0],u=Q[0][1],c=Q[1][0],d=Q[1][1]),s=n,a=u,h=c,f=d;var se=t.select(P).attr("pointer-events","none"),ie=se.selectAll(".overlay").attr("cursor",x[V]);if(t.event.touches)se.on("touchmove.brush",ae,!0).on("touchend.brush touchcancel.brush",le,!0);else{var ue=t.select(t.event.view).on("keydown.brush",function(){switch(t.event.keyCode){case G._keyCode:$=X&&H;break;case N._keyCode:ee=!0,j===m&&(X&&(c=h-p*X,n=s+p*X),H&&(d=f-y*H,u=a+y*H),j=w,oe());break;case I._keyCode:j!==m&&j!==w||(X<0?c=h-p:X>0&&(n=s-p),H<0?d=f-y:H>0&&(u=a-y),j=b,ie.attr("cursor",x.selection),oe());break;default:return}l()},!0).on("keyup.brush",function(){switch(t.event.keyCode){case G._keyCode:$&&(S=E=$=!1,oe());break;case N._keyCode:ee=!1,j===w&&(X<0?c=h:X>0&&(n=s),H<0?d=f:H>0&&(u=a),j=m,oe());break;case I._keyCode:j===b&&(O(t.event,N)||ee?(X&&(c=h-p*X,n=s+p*X),H&&(d=f-y*H,u=a+y*H),j=w):(X<0?c=h:X>0&&(n=s),H<0?d=f:H>0&&(u=a),j=m),ie.attr("cursor",x[V]),oe());break;default:return}l()},!0).on("mousemove.brush",ae,!0).on("mouseup.brush",le,!0);r.dragDisable(t.event.view)}o(),i.interrupt(P),Y.call(P),re.start()}function ae(){var e=t.mouse(P);!$||S||E||(Math.abs(e[0]-ne[0])>Math.abs(e[1]-ne[1])?E=!0:S=!0),ne=e,q=!0,l(),oe()}function oe(){var e;switch(p=ne[0]-te[0],y=ne[1]-te[1],j){case b:case v:X&&(p=Math.max(R-n,Math.min(W-c,p)),s=n+p,h=c+p),H&&(y=Math.max(U-u,Math.min(Z-d,y)),a=u+y,f=d+y);break;case m:X<0?(p=Math.max(R-n,Math.min(W-n,p)),s=n+p,h=c):X>0&&(p=Math.max(R-c,Math.min(W-c,p)),s=n,h=c+p),H<0?(y=Math.max(U-u,Math.min(Z-u,y)),a=u+y,f=d):H>0&&(y=Math.max(U-d,Math.min(Z-d,y)),a=u,f=d+y);break;case w:X&&(s=Math.max(R,Math.min(W,n-p*X)),h=Math.max(R,Math.min(W,c+p*X))),H&&(a=Math.max(U,Math.min(Z,u-y*H)),f=Math.max(U,Math.min(Z,d+y*H)))}h<s&&(X*=-1,e=n,n=c,c=e,e=s,s=h,h=e,V in M&&ie.attr("cursor",x[V=M[V]])),f<a&&(H*=-1,e=u,u=d,d=e,e=a,a=f,f=e,V in C&&ie.attr("cursor",x[V=C[V]])),J.selection&&(Q=J.selection),S&&(s=Q[0][0],h=Q[1][0]),E&&(a=Q[0][1],f=Q[1][1]),Q[0][0]===s&&Q[0][1]===a&&Q[1][0]===h&&Q[1][1]===f||(J.selection=[[s,a],[h,f]],Y.call(P),re.brush())}function le(){if(o(),t.event.touches){if(t.event.touches.length)return;g&&clearTimeout(g),g=setTimeout(function(){g=null},500),se.on("touchmove.brush touchend.brush touchcancel.brush",null)}else r.dragEnable(t.event.view,q),ue.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);se.attr("pointer-events","all"),ie.attr("cursor",x.overlay),J.selection&&(Q=J.selection),K(Q)&&(J.selection=null,Y.call(P)),re.end()}}function L(){var t=this.__brush||{selection:null};return t.extent=P.apply(this,arguments),t.dim=e,t}function Q(e,t){return void 0===t?e.keyCode():(e.keyCode(t),X)}return X.move=function(t,n){t.selection?t.on("start.brush",function(){B(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){B(this,arguments).end()}).tween("brush",function(){var t=this,r=t.__brush,i=B(t,arguments),u=r.selection,a=e.input("function"==typeof n?n.apply(this,arguments):n,r.extent),o=s.interpolate(u,a);function l(e){r.selection=1===e&&K(a)?null:o(e),Y.call(t),i.brush()}return u&&a?l:l(1)}):t.each(function(){var t=arguments,r=this.__brush,s=e.input("function"==typeof n?n.apply(this,t):n,r.extent),u=B(this,t).beforestart();i.interrupt(this),r.selection=null==s||K(s)?null:s,Y.call(this),u.start().brush().end()})},H.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting&&(this.starting=!1,this.emit("start")),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(n){t.customEvent(new a(X,n,e.output(this.state.selection)),V.apply,V,[n,this.that,this.args])}},X.extent=function(e){return arguments.length?(P="function"==typeof e?e:u([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),X):P},X.filter=function(e){return arguments.length?(T="function"==typeof e?e:u(!!e),X):T},X.handleSize=function(e){return arguments.length?(j=+e,X):j},X.on=function(){var e=V.on.apply(V,arguments);return e===V?X:e},X.keyModifier=function(e,t){switch(e){case d:return Q(D,t);case f:return Q(I,t);case p:return Q(N,t);case y:return Q(G,t);default:return X}},X}e.brush=function(){return P(g)},e.brushX=function(){return P(_)},e.brushY=function(){return P(k)},e.brushSelection=function(e){var t=e.__brush;return t?t.dim.output(t.selection):null},e.brushForceNew=d,e.brushFixSize=f,e.brushFixCenter=p,e.brushFixSecondary=y,Object.defineProperty(e,"__esModule",{value:!0})});
